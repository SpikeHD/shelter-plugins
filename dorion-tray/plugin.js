(()=>{var _=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var A=(n,e)=>{for(var s in e)_(n,s,{get:e[s],enumerable:!0})},h=(n,e,s,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of C(e))!E.call(n,t)&&t!==s&&_(n,t,{get:()=>e[t],enumerable:!(a=b(e,t))||a.enumerable});return n};var p=n=>h(_({},"__esModule",{value:!0}),n);var r=(n,e,s)=>new Promise((a,t)=>{var l=o=>{try{d(s.next(o))}catch(u){t(u)}},f=o=>{try{d(s.throw(o))}catch(u){t(u)}},d=o=>o.done?a(o.value):Promise.resolve(o.value).then(l,f);d((s=s.apply(n,e)).next())});var N={};A(N,{onUnload:()=>y});var{flux:{dispatcher:i}}=shelter,{invoke:w}=window.__TAURI__,c={video:!1,streaming:!1,deafened:!1,muted:!1,speaking:!1,connected:!1},T=n=>r(void 0,null,function*(){let{state:e}=n;e.toLowerCase()==="connected"||e.toLowerCase()==="connecting"?c.connected=!0:e.toLowerCase()==="disconnected"&&(c.connected=!1),yield g()}),I=n=>r(void 0,null,function*(){let e=localStorage.getItem("user_id_cache").replace(/"/g,""),s=n.voiceStates.find(d=>d.userId===e);if(!s)return;let{selfDeaf:a,selfMute:t,selfStream:l,selfVideo:f}=s;c.muted=t,c.deafened=a,c.streaming=l,c.video=f,yield g()}),S=n=>r(void 0,null,function*(){let e=localStorage.getItem("user_id_cache").replace(/"/g,""),{userId:s,speakingFlags:a}=n;s===e&&(c.speaking=a>0,yield g())}),g=()=>r(void 0,null,function*(){let n=Object.keys(c).find(e=>c[e])||"disconnected";yield w("set_tray_icon",{event:n})});i.subscribe("VOICE_STATE_UPDATES",I);i.subscribe("SPEAKING",S);i.subscribe("RTC_CONNECTION_STATE",T);var y=()=>{i.unsubscribe("VOICE_STATE_UPDATES",I),i.unsubscribe("SPEAKING",S),i.unsubscribe("RTC_CONNECTION_STATE",T)};return p(N);})();
