(()=>{var ze=Object.create;var j=Object.defineProperty;var Ne=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames,Q=Object.getOwnPropertySymbols,Ae=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var X=(e,t,a)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,te=(e,t)=>{for(var a in t||={})ee.call(t,a)&&X(e,a,t[a]);if(Q)for(var a of Q(t))Se.call(t,a)&&X(e,a,t[a]);return e};var Te=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Re=(e,t)=>{for(var a in t)j(e,a,{get:t[a],enumerable:!0})},ae=(e,t,a,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ie(t))!ee.call(e,o)&&o!==a&&j(e,o,{get:()=>t[o],enumerable:!(n=Ne(t,o))||n.enumerable});return e};var u=(e,t,a)=>(a=e!=null?ze(Ae(e)):{},ae(t||!e||!e.__esModule?j(a,"default",{value:e,enumerable:!0}):a,e)),Le=e=>ae(j({},"__esModule",{value:!0}),e);var g=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{d(a.next(r))}catch(i){o(i)}},c=r=>{try{d(a.throw(r))}catch(i){o(i)}},d=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,c);d((a=a.apply(e,t)).next())});var m=Te((ft,ne)=>{ne.exports=shelter.solidWeb});var yt={};Re(yt,{generateAssetId:()=>q,onLoad:()=>gt,onUnload:()=>pt});var Ce=u(m(),1),Pe=u(m(),1),b=u(m(),1),p=u(m(),1);var oe={name:"Dorion",invoke:(e,t)=>window.__TAURI__.invoke(e,t),event:{emit:(e,t)=>window.__TAURI__.event.emit(e,t),listen:(e,t)=>g(void 0,null,function*(){return window.__TAURI__.event.listen(e,t)})},app:{getVersion:()=>window.__TAURI__.app.getVersion()},process:{relaunch:()=>window.__TAURI__.process.relaunch()},apiWindow:{appWindow:{setFullscreen:e=>window.__TAURI__.window.appWindow.setFullscreen(e)}}};var re={name:"Flooed",invoke:(e,t)=>window.Flooed.invoke(e,t),event:{emit:()=>{},listen:()=>g(void 0,null,function*(){})},app:{getVersion:()=>window.Flooed.version},process:{relaunch:()=>window.Flooed.invoke("relaunch")},apiWindow:{appWindow:{setFullscreen:e=>window.Flooed.invoke("set_fullscreen",e)}}};var ie={name:"Unknown",invoke:()=>g(void 0,null,function*(){}),event:{emit:()=>{},listen:()=>g(void 0,null,function*(){})},app:{getVersion:()=>"0.0.0"},process:{relaunch:()=>{}},apiWindow:{appWindow:{setFullscreen:()=>{}}}};var S="None";window.Dorion?S="Dorion":window.Flooed&&(S="Flooed");var f;switch(S){case"Dorion":f=oe;break;case"Flooed":f=re;break;default:f=ie;break}var zt=window[S];var se=f.name,U=f.invoke,T=f.event,Nt=f.app,It=f.process,At=f.apiWindow;var P=u(m(),1),me=u(m(),1),h=u(m(),1),z=u(m(),1),x=u(m(),1),N=u(m(),1);var le=e=>{let a=Date.now()-e,n=Math.floor(a/1e3),o=Math.floor(n/60),l=Math.floor(o/60),c=Math.floor(l/24);return c>0?`${c} day${c>1?"s":""} ago`:l>0?`${l} hour${l>1?"s":""} ago`:o>0?`${o} minute${o>1?"s":""} ago`:"Just now"};var de="._gameCard_1jztg_1{display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%;height:72px;border-radius:5px;color:var(--text-normal);margin:12px 0}._gameCard_1jztg_1._cardNone_1jztg_1{background-color:var(--background-secondary)}._gameCard_1jztg_1._cardPlaying_1jztg_1{background-color:var(--status-positive-background)}._gameCard_1jztg_1._cardPlaying_1jztg_1 ._gameCardIcons_1jztg_1{color:var(--green-230)}._gameCard_1jztg_1._cardPlayed_1jztg_1{background:rgba(0,0,0,0);border-radius:0;border-bottom:1px solid var(--primary-500)}._gameCard_1jztg_1._cardPlayed_1jztg_1 ._gameCardLastPlayed_1jztg_1{color:var(--text-muted)}._gameCard_1jztg_1._cardPlayed_1jztg_1 ._lastPlayedTimestamp_1jztg_1{font-weight:bold}._gameCardInfo_1jztg_1{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;width:70%;height:100%;padding:0 20px}._gameCardName_1jztg_1{font-weight:bold}._gameCardIcons_1jztg_1{display:flex;flex-direction:row;align-items:center;justify-content:flex-end;height:100%;padding:0 20px;color:var(--primary-400)}._gameCardIcons_1jztg_1 span{margin:4px;width:24px;height:24px;cursor:pointer}._gameCardIcons_1jztg_1 span:hover{color:var(--text-normal)}._gameCardIcons_1jztg_1 span svg{width:100%;height:100%}._trash_1jztg_1:hover{color:var(--status-danger) !important}",v={gameCard:"_gameCard_1jztg_1",cardNone:"_cardNone_1jztg_1",cardPlaying:"_cardPlaying_1jztg_1",gameCardIcons:"_gameCardIcons_1jztg_1",cardPlayed:"_cardPlayed_1jztg_1",gameCardLastPlayed:"_gameCardLastPlayed_1jztg_1",lastPlayedTimestamp:"_lastPlayedTimestamp_1jztg_1",gameCardInfo:"_gameCardInfo_1jztg_1",gameCardName:"_gameCardName_1jztg_1",trash:"_trash_1jztg_1"};var De=(0,P.template)('<svg aria-hidden="true" role="img" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M15 3.999V2H9V3.999H3V5.999H21V3.999H15Z"></path><path fill="currentColor" d="M5 6.99902V18.999C5 20.101 5.897 20.999 7 20.999H17C18.103 20.999 19 20.101 19 18.999V6.99902H5ZM11 17H9V11H11V17ZM15 17H13V11H15V17Z"></path></svg>',6),Fe=(0,P.template)('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 8.449-11.985 8.449c-7.18 0-12.015-8.449-12.015-8.449s4.446-7.551 12.015-7.551c7.694 0 11.985 7.551 11.985 7.551zm-7 .449c0-2.757-2.243-5-5-5s-5 2.243-5 5 2.243 5 5 5 5-2.243 5-5z"></path></svg>',4),Me=(0,P.template)('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M11.885 14.988l3.104-3.098.011.11c0 1.654-1.346 3-3 3l-.115-.012zm8.048-8.032l-3.274 3.268c.212.554.341 1.149.341 1.776 0 2.757-2.243 5-5 5-.631 0-1.229-.13-1.785-.344l-2.377 2.372c1.276.588 2.671.972 4.177.972 7.733 0 11.985-8.449 11.985-8.449s-1.415-2.478-4.067-4.595zm1.431-3.536l-18.619 18.58-1.382-1.422 3.455-3.447c-3.022-2.45-4.818-5.58-4.818-5.58s4.446-7.551 12.015-7.551c1.825 0 3.456.426 4.886 1.075l3.081-3.075 1.382 1.42zm-13.751 10.922l1.519-1.515c-.077-.264-.132-.538-.132-.827 0-1.654 1.346-3 3-3 .291 0 .567.055.833.134l1.518-1.515c-.704-.382-1.496-.619-2.351-.619-2.757 0-5 2.243-5 5 0 .852.235 1.641.613 2.342z"></path></svg>',4),Be=(0,P.template)("<div><div><span></span><span></span></div><div></div></div>",10),V=(0,P.template)("<span></span>",2),{ui:{injectCss:Ue},plugin:{store:w},solid:{createSignal:Ve}}=shelter,He=()=>De.cloneNode(!0),We=()=>Fe.cloneNode(!0),Ge=()=>Me.cloneNode(!0),ce=!1,Oe=e=>{backend!=="None"&&T.emit("remove_detectable",{name:e,exe:""});let t=Object.keys(w.previouslyPlayed).find(a=>w.previouslyPlayed[a].name===e);delete w.previouslyPlayed[t],w.currentlyPlaying===e&&(w.currentlyPlaying="")},R=e=>{var n;ce||(ce=!0,Ue(de));let[t,a]=Ve(e.name?(n=w.previouslyPlayed[e.name])==null?void 0:n.hide:!1);return(()=>{let o=Be.cloneNode(!0),l=o.firstChild,c=l.firstChild,d=c.nextSibling,r=l.nextSibling;return(0,x.insert)(c,()=>e.name||"No game detected"),(0,x.insert)(d,(()=>{let i=(0,N.memo)(()=>e.type==="played");return()=>i()?["Last played: ",(()=>{let s=V.cloneNode(!0);return(0,x.insert)(s,()=>le(e.lastPlayed)),(0,z.effect)(()=>(0,h.className)(s,v.lastPlayedTimestamp)),s})()]:e.type==="playing"&&e.name?"Now playing!":"What are you playing?"})()),(0,x.insert)(r,(()=>{let i=(0,N.memo)(()=>!!e.local);return()=>i()&&(()=>{let s=V.cloneNode(!0);return s.$$click=()=>{Oe(e.name||"")},(0,x.insert)(s,He),(0,z.effect)(()=>(0,h.className)(s,v.trash)),s})()})(),null),(0,x.insert)(r,(()=>{let i=(0,N.memo)(()=>!!(e.name&&e.type!=="playing"));return()=>i()&&(()=>{let s=V.cloneNode(!0);return s.$$click=()=>{if(!e.name)return;let $=Object.keys(w.previouslyPlayed).find(A=>w.previouslyPlayed[A].name===e.name);w.previouslyPlayed[$].hide=!t(),a(!t())},(0,x.insert)(s,(()=>{let $=(0,N.memo)(()=>!!t());return()=>$()?Ge():We()})()),(0,z.effect)(()=>(0,h.className)(s,v.hide)),s})()})(),null),(0,z.effect)(i=>{let s=v.gameCard+" "+(e.type==="playing"&&e.name?v.cardPlaying:e.type==="played"?v.cardPlayed:v.cardNone),$=v.gameCardInfo,A=v.gameCardName,J=v.gameCardLastPlayed,K=v.gameCardIcons;return s!==i._v$&&(0,h.className)(o,i._v$=s),$!==i._v$2&&(0,h.className)(l,i._v$2=$),A!==i._v$3&&(0,h.className)(c,i._v$3=A),J!==i._v$4&&(0,h.className)(d,i._v$4=J),K!==i._v$5&&(0,h.className)(r,i._v$5=K),i},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),o})()};(0,me.delegateEvents)(["click"]);var W=u(m(),1),D=u(m(),1),fe=u(m(),1),H=u(m(),1),he=u(m(),1),F=u(m(),1),we=u(m(),1),I=u(m(),1);var _e="._ddown_1dg83_1{box-sizing:border-box;font-size:16px;width:100%;border-radius:3px;color:var(--text-normal);background-color:var(--input-background);border:none;transition:border-color .2s ease-in-out;padding:10px;appearance:none;cursor:pointer}._dcontainer_1dg83_1{position:relative;width:100%}._dsarrow_1dg83_1{position:absolute;right:10px;top:50%;transform:translateY(-50%);pointer-events:none}._dsarrow_1dg83_1 path{fill:var(--header-secondary)}",L={ddown:"_ddown_1dg83_1",dcontainer:"_dcontainer_1dg83_1",dsarrow:"_dsarrow_1dg83_1"};var ue=u(m(),1),ge=u(m(),1),pe=u(m(),1),Ee=(0,ue.template)('<svg aria-hidden="true" role="img" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M16.59 8.59003L12 13.17L7.41 8.59003L6 10L12 16L18 10L16.59 8.59003Z"></path></svg>',4),ye=e=>(()=>{let t=Ee.cloneNode(!0);return(0,pe.effect)(()=>(0,ge.setAttribute)(t,"class",e.class)),t})();var Ze=(0,W.template)("<div><select></select></div>",4),Ye=(0,W.template)("<option></option>",2),{ui:{injectCss:qe}}=shelter,ve=!1,$e=e=>(ve||(ve=!0,qe(_e)),(()=>{let t=Ze.cloneNode(!0),a=t.firstChild;return(0,we.addEventListener)(a,"change",e.onChange),(0,F.insert)(a,()=>{var n;return(n=e.options)==null?void 0:n.map(o=>(()=>{let l=Ye.cloneNode(!0);return(0,F.insert)(l,()=>o.label),(0,I.effect)(()=>l.selected=o.value===(e==null?void 0:e.selected)),(0,I.effect)(()=>l.value=o.value),l})())}),(0,F.insert)(t,(0,he.createComponent)(ye,{get class(){return L.dsarrow}}),null),(0,I.effect)(n=>{let o=L.dcontainer,l=e.style,c=L.ddown,d=e.placeholder,r=e.id,i=e["aria-label"],s=e.disabled;return o!==n._v$&&(0,H.className)(t,n._v$=o),n._v$2=(0,fe.style)(t,l,n._v$2),c!==n._v$3&&(0,H.className)(a,n._v$3=c),d!==n._v$4&&(0,D.setAttribute)(a,"placeholder",n._v$4=d),r!==n._v$5&&(0,D.setAttribute)(a,"id",n._v$5=r),i!==n._v$6&&(0,D.setAttribute)(a,"aria-label",n._v$6=i),s!==n._v$7&&(a.disabled=n._v$7=s),n},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0}),(0,I.effect)(()=>a.value=e.value),t})());var xe="._description_1kj0u_1{margin-top:8px;margin-bottom:8px}._addIt_1kj0u_1{margin-top:8px;margin-bottom:28px}._shead_1kj0u_1{margin-bottom:12px}._addhead_1kj0u_1{margin-top:42px;margin-bottom:12px}._modalhead_1kj0u_1{margin-top:12px}",k={description:"_description_1kj0u_1",addIt:"_addIt_1kj0u_1",shead:"_shead_1kj0u_1",addhead:"_addhead_1kj0u_1",modalhead:"_modalhead_1kj0u_1"};var Je=(0,Ce.template)('<a target="_blank">Add it!</a>',2),{ui:{Divider:Ke,Header:G,HeaderTags:Qe,Text:O,TextBox:Xe,injectCss:et,openModal:tt,ModalRoot:at,ModalHeader:nt,ModalBody:ot,ModalConfirmFooter:rt},solid:{createSignal:C,createEffect:ke},plugin:{store:M}}=shelter,be=!1,je=()=>{be||(be=!0,et(xe));let[e,t]=C(!1),[a,n]=C(""),[o,l]=C({}),[c,d]=C([]);return ke(()=>g(void 0,null,function*(){t(se==="Dorion"),n(M.currentlyPlaying||""),l(M.previouslyPlayed||{}),d(e&&(yield U("get_local_detectables")));let r=()=>{for(let i of c()){let s=Object.values(o()).findIndex($=>$.name===i.name);s!==-1&&(o()[Object.keys(o())[s]].local=!0)}};r(),setInterval(()=>{n(M.currentlyPlaying||""),l(M.previouslyPlayed||{}),r()},2e3)})),[(0,p.createComponent)(G,{get tag(){return Qe.H1},get class(){return k.shead},children:"Registered Games"}),(0,p.createComponent)(O,{get class(){return k.description},children:"ShelteRPC will automatically update your status based on the game you're playing (if detectable). You can also manually add games to this list if it isn't being detected."}),(0,p.createComponent)(Ke,{mt:20,mb:20}),(0,b.memo)((()=>{let r=(0,b.memo)(()=>!!a());return()=>r()?(0,p.createComponent)(R,{get name(){return a()},type:"playing",get local(){var i;return((i=Object.values(o()).find(s=>s.name===a()))==null?void 0:i.local)||!1}}):(0,p.createComponent)(R,{type:"none"})})()),(0,p.createComponent)(O,{get class(){return k.addIt},get children(){return["Not seeing your game? ",(0,b.memo)(()=>(0,b.memo)(()=>!!e())()?(()=>{let r=Je.cloneNode(!0);return r.$$click=it,r})():"Adding it is unsupported.")]}}),(0,p.createComponent)(G,{get class(){return k.addhead},children:"Added Games"}),(0,b.memo)(()=>Object.values(o()).map(r=>r.name===a()?null:(0,p.createComponent)(R,{get name(){return r.name},get lastPlayed(){return r.lastPlayed},type:"played",get local(){return r==null?void 0:r.local}})))]};function it(){let[e,t]=C([]),[a,n]=C(0),[o,l]=C("");ke(()=>g(this,null,function*(){let c=yield U("get_windows");t(c)})),tt(c=>(0,p.createComponent)(at,{get children(){return[(0,p.createComponent)(nt,{get close(){return c.close},children:"Add a game"}),(0,p.createComponent)(ot,{get children(){return(0,b.memo)(()=>e().length>0)()?[(0,p.createComponent)($e,{get options(){return e().filter((d,r,i)=>i.findIndex(s=>s.process_name===d.process_name)===r).map(d=>({label:d.process_name,value:d.pid}))},placeholder:"Select process...",maxVisibleItems:5,closeOnSelect:!0,onChange:d=>n(Number(d.target.value))}),(0,p.createComponent)(G,{get class(){return k.modalhead},children:"Name to Display"}),(0,p.createComponent)(Xe,{get value(){return o()},onInput:d=>l(d),placeholder:"Enter the name to display..."})]:(0,p.createComponent)(O,{children:"Please wait..."})}}),(0,p.createComponent)(rt,{onConfirm:()=>{var d;T.emit("add_detectable",{exe:(d=e().find(r=>r.pid===a()))==null?void 0:d.process_name,name:o()})},get onCancel(){return c.close},confirmText:"Add",cancelText:"Cancel",type:"neutral"})]}}))}(0,Pe.delegateEvents)(["click"]);var{flux:{dispatcher:st,stores:{GameStore:lt}},settings:{registerSection:dt},ui:{showToast:E},plugin:{store:y},http:ct}=shelter,Y=()=>{},Z={},_,B={};y.currentlyPlaying="";function mt(e){return g(this,null,function*(){var t;return((t=lt.getGameByName(e))==null?void 0:t.name)||"Unknown"})}var q=(e,t)=>g(void 0,null,function*(){var n;if(!Z[e]){let o=yield ct.get(`/oauth2/applications/${e}/assets`);o.status!==200&&console.log("Failed to fetch assets"),Z[e]=o.body}return(n=Z[e].find(o=>o.name===t))==null?void 0:n.id});function _t(e){return g(this,null,function*(){var n,o,l,c,d,r;let t=JSON.parse(e.data),a=(n=t.activity)==null?void 0:n.assets;if(a!=null&&a.large_image&&(a.large_image=yield q(t.activity.application_id,a.large_image)),a!=null&&a.small_image&&(a.small_image=yield q(t.activity.application_id,a.small_image)),t.activity){let i=t.activity.application_id;B[i]||(B[i]=yield mt(t.activity.name));let s=B[i];if(typeof s!="string"&&((o=t.activity).name||(o.name=s.name)),y.currentlyPlaying=t.activity.name,y.previouslyPlayed||(y.previouslyPlayed={}),!((l=t.activity)!=null&&l.name))return;t.activity.name in y.previouslyPlayed||(y.previouslyPlayed[t.activity.name]={}),y.previouslyPlayed[t.activity.name].name=t.activity.name,y.previouslyPlayed[t.activity.name].appid=t.activity.application_id,y.previouslyPlayed[t.activity.name].lastPlayed=Date.now(),y.previouslyPlayed[t.activity.name].local=t.activity.application_id==="1337"}else y.currentlyPlaying="";(r=(d=y==null?void 0:y.previouslyPlayed)==null?void 0:d[(c=t.activity)==null?void 0:c.name])!=null&&r.hide||st.dispatch(te({type:"LOCAL_ACTIVITY_UPDATE"},t))})}var ut=(e,t=5,a=500)=>g(void 0,null,function*(){let n;for(let o=0;o<t;o++){if(n=yield e(o),n)return n;yield new Promise(l=>setTimeout(l,a))}return n}),gt=()=>g(void 0,null,function*(){_&&(_!=null&&_.close)&&_.close();let e=yield ut(t=>g(void 0,null,function*(){var a;return _=new WebSocket("ws://127.0.0.1:1337"),_.onmessage=_t,_.onerror=n=>{throw n},yield new Promise(n=>setTimeout(n,1e3)),_.readyState!==WebSocket.OPEN?((a=_==null?void 0:_.close)==null||a.call(_),_=null,E({title:"ShelteRPC",content:`Unable to connect to ShelteRPC server (${t})`,duration:2e3}),!1):!0}),3,3e3);Y=dt("section","shelterpc","Registered Games",je),e&&(_.onclose=()=>{E({title:"ShelteRPC",content:"ShelteRPC server disconnected",duration:3e3})},E({title:"ShelteRPC",content:"Connected to ShelteRPC server",duration:3e3}))}),pt=()=>g(void 0,null,function*(){var e;_!=null&&_.close&&((e=_.close)==null||e.call(_)),Y&&Y()});return Le(yt);})();
