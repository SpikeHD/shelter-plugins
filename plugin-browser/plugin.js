(()=>{var M=Object.create;var d=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var ee=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),te=(e,n)=>{for(var t in n)d(e,t,{get:n[t],enumerable:!0})},H=(e,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of X(n))!Z.call(e,s)&&s!==t&&d(e,s,{get:()=>n[s],enumerable:!(o=Q(n,s))||o.enumerable});return e};var i=(e,n,t)=>(t=e!=null?M(Y(e)):{},H(n||!e||!e.__esModule?d(t,"default",{value:e,enumerable:!0}):t,e)),ne=e=>H(d({},"__esModule",{value:!0}),e);var u=(e,n,t)=>new Promise((o,s)=>{var x=r=>{try{c(t.next(r))}catch(l){s(l)}},g=r=>{try{c(t.throw(r))}catch(l){s(l)}},c=r=>r.done?o(r.value):Promise.resolve(r.value).then(x,g);c((t=t.apply(e,n)).next())});var a=ee((ye,I)=>{I.exports=shelter.solidWeb});var Ce={};te(Ce,{onUnload:()=>xe});var b=i(a(),1),B=i(a(),1),w=i(a(),1),G=i(a(),1),$=i(a(),1),k=i(a(),1),p=i(a(),1);var R="._subtitle_rel3j_1{margin-top:12px;display:block}._pluginList_rel3j_1{display:grid;grid-template-columns:repeat(2, 1fr);grid-gap:16px;margin-top:16px}._repoHeader_rel3j_1{display:flex;flex-direction:row;justify-content:space-between;align-items:center}",f={subtitle:"_subtitle_rel3j_1",pluginList:"_pluginList_rel3j_1",repoHeader:"_repoHeader_rel3j_1"};var P=i(a(),1),y=i(a(),1),z=i(a(),1),h=i(a(),1),_=i(a(),1),He=i(a(),1);function J(e){localStorage.setItem("plugins-browser-cache",`${Date.now()};${JSON.stringify(e)}`)}function L(){let e=localStorage.getItem("plugins-browser-cache");if(!e)return null;let[n,t]=e.split(";"),o=null;try{o=JSON.parse(t)}catch(s){return console.log("[Plugin Browser] Error parsing cache JSON: ",s),null}return re(n),o}function re(e){Date.now()-parseInt(e)>1e3*60*60&&localStorage.removeItem("plugins-browser-cache")}var C=e=>u(void 0,null,function*(){return fetch(e,{headers:{"User-Agent":"Shelter Plugin Browser"}})});function oe(){return u(this,null,function*(){return(yield(yield C("https://api.github.com/search/repositories?q=topic:shelter-plugins")).json()).items.map(t=>({name:t.name,description:t.description,url:t.html_url,stars:t.stargazers_count,owner:t.owner.login,owner_url:t.owner.html_url,owner_avatar:t.owner.avatar_url,homepage:t.homepage}))})}function se(e){return u(this,null,function*(){return e.homepage?e.homepage:`https://${e.owner}.github.io/${e.name}`})}function ae(e){return u(this,null,function*(){return(yield(yield C(`https://api.github.com/repos/${e.owner}/${e.name}/contents/plugins`)).json()).map(o=>o.name)})}function A(e,n){return u(this,null,function*(){let t=yield C(`${e}/${n}/plugin.json`);try{return yield t.json()}catch(o){return console.log("[Plugin Browser] Error parsing plugin.json: ",o.message),null}})}function D(){return u(this,null,function*(){let e=yield oe(),n=yield Promise.all(e.map(t=>u(this,null,function*(){let o=yield se(t);if(!o)return console.log("[Plugin Browser] No site found for repo: ",t.name),null;let s=yield ae(t);return s?{repo:t,site:o,plugins:s}:(console.log("[Plugin Browser] No plugins found for repo: ",t.name),null)})));return n=n.filter(t=>t!==null),J(n),n})}var E="._pluginCard_9arrd_1{display:flex;flex-direction:column;justify-content:space-evenly;align-items:flex-start;text-align:left;padding:16px;color:var(--text-primary);background:var(--background-secondary);border-radius:8px}._pluginCard_9arrd_1 ._contents_9arrd_1{margin-top:8px;flex:1}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1{margin-top:8px;width:100%}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1 ._installButton_9arrd_1{flex-grow:1;width:100%}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1 ._installButton_9arrd_1 button P{width:100%}",m={pluginCard:"_pluginCard_9arrd_1",contents:"_contents_9arrd_1",buttonContainer:"_buttonContainer_9arrd_1",installButton:"_installButton_9arrd_1"};var O=(0,P.template)("<b></b>",2),ie=(0,P.template)("<div><div></div></div>",4),{ui:{injectCss:le,Button:ue,Text:T},solid:{createSignal:U,createEffect:ce},plugins:{installedPlugins:j,addRemotePlugin:ge}}=shelter,q=!1;function F(e){q||(le(E),q=!0);let[n,t]=U({}),[o,s]=U(!1);ce(()=>u(this,null,function*(){t(yield A(e.site,e.plugin));let g=Object.values((j==null?void 0:j())||{}).some(c=>{var r,l;return c.manifest.name===((r=n())==null?void 0:r.name)&&c.manifest.author===((l=n())==null?void 0:l.author)});s(g)}));let x=()=>{ge(e.plugin,e.install_url,!0),s(!0)};return(()=>{let g=ie.cloneNode(!0),c=g.firstChild;return(0,_.insert)(g,(0,h.createComponent)(T,{get class(){return m.name},get children(){return[(()=>{let r=O.cloneNode(!0);return(0,_.insert)(r,()=>{var l;return((l=n())==null?void 0:l.name)||"Unknown"}),r})()," by ",(()=>{let r=O.cloneNode(!0);return(0,_.insert)(r,()=>e.author),r})()]}}),c),(0,_.insert)(g,(0,h.createComponent)(T,{get class(){return m.contents},get children(){var r;return(r=n())==null?void 0:r.description}}),c),(0,_.insert)(c,(0,h.createComponent)(ue,{get class(){return m.installButton},onClick:x,get disabled(){var r;return o()||!((r=n())!=null&&r.name)},get children(){return o()?"Installed":"Install"}})),(0,z.effect)(r=>{let l=m.pluginCard,S=m.buttonContainer;return l!==r._v$&&(0,y.className)(g,r._v$=l),S!==r._v$2&&(0,y.className)(c,r._v$2=S),r},{_v$:void 0,_v$2:void 0}),g})()}var pe=(0,b.template)('<a href="https://github.com/SpikeHD/shelter-plugins/tree/main/plugins/plugin-browser" target="_blank">Take a look</a>',2),me=(0,b.template)('<a target="_blank">View Repository</a>',2),V=(0,b.template)("<div></div>",2),{ui:{injectCss:_e,Header:v,HeaderTags:N,Text:de,Divider:fe},solid:{createSignal:he,createEffect:we}}=shelter,W=!1;function K(){W||(_e(R),W=!0);let[e,n]=he([]);return we(()=>u(this,null,function*(){n(L()||(yield D()))})),[(0,p.createComponent)(v,{get tag(){return N.H1},children:"Plugins"}),(0,p.createComponent)(de,{get class(){return f.subtitle},get children(){return["Not seeing your plugin repo? ",pe.cloneNode(!0)," at how this plugin finds repos!"]}}),(0,k.memo)(()=>e().map(t=>[(0,p.createComponent)(fe,{mt:16,mb:16}),(()=>{let o=V.cloneNode(!0);return(0,w.insert)(o,(0,p.createComponent)(v,{get tag(){return N.H2},get children(){return t.repo.owner}}),null),(0,w.insert)(o,(0,p.createComponent)(v,{get tag(){return N.H2},get children(){return[(()=>{let s=me.cloneNode(!0);return(0,$.effect)(()=>(0,G.setAttribute)(s,"href",t.repo.url)),s})()," - ",(0,k.memo)(()=>t.repo.stars)," \u2B50"]}}),null),(0,$.effect)(()=>(0,B.className)(o,f.repoHeader)),o})(),(()=>{let o=V.cloneNode(!0);return(0,w.insert)(o,()=>t.plugins.map(s=>s.toLowerCase().includes("dorion")?null:(0,p.createComponent)(F,{plugin:s,get site(){return t.site},get author(){return t.repo.owner},get install_url(){return`${t.site}/${s}`}}))),(0,$.effect)(()=>(0,B.className)(o,f.pluginList)),o})()]))]}var{settings:{registerSection:$e}}=shelter,be=$e("section","plugin-browser","Plugin Browser",K),xe=()=>{be()};return ne(Ce);})();
