(()=>{var ae=Object.create;var _=Object.defineProperty,ie=Object.defineProperties,le=Object.getOwnPropertyDescriptor,ce=Object.getOwnPropertyDescriptors,ue=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols,ge=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var H=(e,n,t)=>n in e?_(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,R=(e,n)=>{for(var t in n||={})O.call(n,t)&&H(e,t,n[t]);if(L)for(var t of L(n))pe.call(n,t)&&H(e,t,n[t]);return e},T=(e,n)=>ie(e,ce(n));var me=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),de=(e,n)=>{for(var t in n)_(e,t,{get:n[t],enumerable:!0})},D=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of ue(n))!O.call(e,r)&&r!==t&&_(e,r,{get:()=>n[r],enumerable:!(s=le(n,r))||s.enumerable});return e};var u=(e,n,t)=>(t=e!=null?ae(ge(e)):{},D(n||!e||!e.__esModule?_(t,"default",{value:e,enumerable:!0}):t,e)),fe=e=>D(_({},"__esModule",{value:!0}),e);var g=(e,n,t)=>new Promise((s,r)=>{var a=o=>{try{i(t.next(o))}catch(p){r(p)}},l=o=>{try{i(t.throw(o))}catch(p){r(p)}},i=o=>o.done?s(o.value):Promise.resolve(o.value).then(a,l);i((t=t.apply(e,n)).next())});var c=me((Ae,A)=>{A.exports=shelter.solidWeb});var Te={};de(Te,{onUnload:()=>Re});var P=u(c(),1),x=u(c(),1),w=u(c(),1),oe=u(c(),1),$=u(c(),1),C=u(c(),1),m=u(c(),1);var E="._subtitle_cy731_1{margin-top:12px;display:block}._pluginList_cy731_1{display:grid;grid-template-columns:repeat(2, 1fr);grid-gap:16px;margin-top:16px}._repoHeader_cy731_1{display:flex;flex-direction:row;justify-content:space-between;align-items:center}._loading_cy731_1{display:flex;justify-content:center;align-items:center;height:100%}",h={subtitle:"_subtitle_cy731_1",pluginList:"_pluginList_cy731_1",repoHeader:"_repoHeader_cy731_1",loading:"_loading_cy731_1"};var N=u(c(),1),S=u(c(),1),Y=u(c(),1),y=u(c(),1),f=u(c(),1),Ge=u(c(),1);function F(){let e=document.createElement("iframe"),n=setInterval(()=>{if(!document.head)return;document.head.append(e);let t=Object.getOwnPropertyDescriptor(e.contentWindow,"localStorage");e.remove(),t&&(Object.defineProperty(window,"localStorage",t),clearInterval(n))},50)}function U(e){localStorage.setItem("plugins-browser-cache",`${Date.now()};${JSON.stringify(e)}`)}function W(){let e=localStorage.getItem("plugins-browser-cache");if(!e)return null;let[n,t]=e.split(";"),s=null;try{s=JSON.parse(t)}catch(r){return console.log("[Plugin Browser] Error parsing cache JSON: ",r),null}return _e(n),s}function _e(e){Date.now()-parseInt(e)>1e3*60*60&&localStorage.removeItem("plugins-browser-cache")}function v(){let e=localStorage.getItem("plugins-browser-plugin-json");if(!e)return{};let[n,t]=e.split(";"),s=null;try{s=JSON.parse(t)}catch(r){return console.log("[Plugin Browser] Error parsing cache JSON: ",r),{}}return he(n),s}function q(e,n){localStorage.setItem("plugins-browser-plugin-json",`${Date.now()};${JSON.stringify(T(R({},v()),{[e]:n}))}`)}function he(e){Date.now()-parseInt(e)>1e3*60*60&&localStorage.removeItem("plugins-browser-plugin-json")}var b=e=>g(void 0,null,function*(){return fetch(e,{headers:{"User-Agent":"Shelter Plugin Browser"}})});function we(){return g(this,null,function*(){return(yield(yield b("https://api.github.com/search/repositories?q=shelter-plugins")).json()).items.map(t=>({name:t.name,description:t.description,url:t.html_url,stars:t.stargazers_count,owner:t.owner.login,owner_url:t.owner.html_url,owner_avatar:t.owner.avatar_url,homepage:t.homepage}))})}function $e(e){return g(this,null,function*(){return e.homepage?e.homepage:`https://${e.owner}.github.io/${e.name}`})}function be(e){return g(this,null,function*(){let t=yield(yield b(`https://api.github.com/repos/${e.owner}/${e.name}/contents/plugins`)).json();return Array.isArray(t)?t.map(s=>s.name):[]})}function ye(e,n){return g(this,null,function*(){let t=n==null?void 0:n[0];if(!t)return e;let s=[`${e}/shelter-plugins/`,`${e}/`],r=e;for(let a of s){let l=`${a}/${t}/plugin.json`,i=yield b(l);try{if((yield i.json()).name){r=a;break}}catch(o){}}return r})}function z(e,n){return g(this,null,function*(){let t=`${e}/${n}/plugin.json`,s=v();if(s[t])return s[t];let r=yield b(t);try{let a=yield r.json();return q(t,a),a}catch(a){return console.log("[Plugin Browser] Error parsing plugin.json: ",a.message),null}})}function V(){return g(this,null,function*(){let e=yield we(),n=yield Promise.all(e.map(t=>g(this,null,function*(){let s=yield $e(t);if(!s)return console.log("[Plugin Browser] No site found for repo: ",t.name),null;let r=yield be(t);return!r||r.length===0?(console.log(`[Plugin Browser] No plugins found for repo: ${t.owner}/${t.name}`),null):{site:yield ye(s,r),repo:t,plugins:r}})));return n=n.filter(t=>t!==null),U(n),n})}var G="._pluginCard_9arrd_1{display:flex;flex-direction:column;justify-content:space-evenly;align-items:flex-start;text-align:left;padding:16px;color:var(--text-primary);background:var(--background-secondary);border-radius:8px}._pluginCard_9arrd_1 ._contents_9arrd_1{margin-top:8px;flex:1}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1{margin-top:8px;width:100%}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1 ._installButton_9arrd_1{flex-grow:1;width:100%}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1 ._installButton_9arrd_1 button P{width:100%}",d={pluginCard:"_pluginCard_9arrd_1",contents:"_contents_9arrd_1",buttonContainer:"_buttonContainer_9arrd_1",installButton:"_installButton_9arrd_1"};var K=(0,N.template)("<b></b>",2),xe=(0,N.template)("<div><div></div></div>",4),{ui:{injectCss:Ce,Button:Pe,Text:M},solid:{createSignal:Q,createEffect:ve},plugins:{installedPlugins:j,addRemotePlugin:je}}=shelter,X=!1;function Z(e){X||(Ce(G),X=!0);let[n,t]=Q({}),[s,r]=Q(!1);ve(()=>g(this,null,function*(){t(yield z(e.site,e.plugin));let l=Object.values((j==null?void 0:j())||{}).some(i=>{var o,p;return i.manifest.name===((o=n())==null?void 0:o.name)&&i.manifest.author===((p=n())==null?void 0:p.author)});r(l)}));let a=()=>{je(e.plugin,e.install_url,!0),r(!0)};return(()=>{let l=xe.cloneNode(!0),i=l.firstChild;return(0,f.insert)(l,(0,y.createComponent)(M,{get class(){return d.name},get children(){return[(()=>{let o=K.cloneNode(!0);return(0,f.insert)(o,()=>{var p;return((p=n())==null?void 0:p.name)||e.plugin}),o})()," by ",(()=>{let o=K.cloneNode(!0);return(0,f.insert)(o,()=>e.author),o})()]}}),i),(0,f.insert)(l,(0,y.createComponent)(M,{get class(){return d.contents},get children(){var o;return(o=n())==null?void 0:o.description}}),i),(0,f.insert)(i,(0,y.createComponent)(Pe,{get class(){return d.installButton},onClick:a,get disabled(){var o;return s()||!((o=n())!=null&&o.name)},get children(){return s()?"Installed":"Install"}})),(0,Y.effect)(o=>{let p=d.pluginCard,k=d.buttonContainer;return p!==o._v$&&(0,S.className)(l,o._v$=p),k!==o._v$2&&(0,S.className)(i,o._v$2=k),o},{_v$:void 0,_v$2:void 0}),l})()}var Se=(0,P.template)('<a href="https://github.com/SpikeHD/shelter-plugins/tree/main/plugins/plugin-browser" target="_blank">Take a look</a>',2),Ne=(0,P.template)('<a target="_blank">View Repository</a>',2),I=(0,P.template)("<div></div>",2),{ui:{injectCss:Ie,Header:B,HeaderTags:J,Text:ee,Divider:te,TextBox:Be,showToast:Je},solid:{createSignal:ne,createEffect:ke}}=shelter,re=!1,Le=(e,n)=>{let t=null;return(...s)=>{window.clearTimeout(t),t=window.setTimeout(()=>{e(...s)},n)}};function se(){re||(Ie(E),re=!0);let[e,n]=ne([]),[t,s]=ne("");return ke(()=>g(this,null,function*(){n(W()||(yield V().catch(r=>(console.error(r),Je({title:"Plugin Browser",content:"Failed to load plugins, check DevTools for error.",duration:5e3}),[]))))})),[(0,m.createComponent)(B,{get tag(){return J.H1},children:"Plugins"}),(0,m.createComponent)(ee,{get class(){return h.subtitle},get children(){return["Not seeing your plugin repo? ",Se.cloneNode(!0)," at how this plugin finds repos!"]}}),(0,m.createComponent)(te,{mt:16,mb:16}),(0,m.createComponent)(Be,{get value(){return t()},get onInput(){return Le(r=>s(r),100)},placeholder:"Search..."}),(0,C.memo)((()=>{let r=(0,C.memo)(()=>e().length>0);return()=>r()?e().map(a=>[(0,m.createComponent)(te,{mt:16,mb:16}),(()=>{let l=I.cloneNode(!0);return(0,w.insert)(l,(0,m.createComponent)(B,{get tag(){return J.H2},get children(){return a.repo.owner}}),null),(0,w.insert)(l,(0,m.createComponent)(B,{get tag(){return J.H2},get children(){return[(()=>{let i=Ne.cloneNode(!0);return(0,$.effect)(()=>(0,oe.setAttribute)(i,"href",a.repo.url)),i})()," - ",(0,C.memo)(()=>a.repo.stars)," \u2B50"]}}),null),(0,$.effect)(()=>(0,x.className)(l,h.repoHeader)),l})(),(()=>{let l=I.cloneNode(!0);return(0,w.insert)(l,()=>a.plugins.map(i=>i.toLowerCase().includes("dorion")||!i.toLowerCase().includes(t().toLowerCase())?null:(0,m.createComponent)(Z,{plugin:i,get site(){return a.site},get author(){return a.repo.owner},get install_url(){return`${a.site}/${i}`}}))),(0,$.effect)(()=>(0,x.className)(l,h.pluginList)),l})()]):(()=>{let a=I.cloneNode(!0);return(0,w.insert)(a,(0,m.createComponent)(ee,{children:"Loading..."})),(0,$.effect)(()=>(0,x.className)(a,h.loading)),a})()})())]}var{settings:{registerSection:He}}=shelter,Oe=He("section","plugin-browser","Plugin Browser",se);window.localStorage||F();var Re=()=>{Oe()};return fe(Te);})();
