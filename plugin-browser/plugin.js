(()=>{var se=Object.create;var _=Object.defineProperty,ae=Object.defineProperties,ie=Object.getOwnPropertyDescriptor,le=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertyNames,k=Object.getOwnPropertySymbols,ue=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var H=(e,r,t)=>r in e?_(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,O=(e,r)=>{for(var t in r||={})L.call(r,t)&&H(e,t,r[t]);if(k)for(var t of k(r))ge.call(r,t)&&H(e,t,r[t]);return e},R=(e,r)=>ae(e,le(r));var pe=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),me=(e,r)=>{for(var t in r)_(e,t,{get:r[t],enumerable:!0})},A=(e,r,t,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of ce(r))!L.call(e,n)&&n!==t&&_(e,n,{get:()=>r[n],enumerable:!(s=ie(r,n))||s.enumerable});return e};var u=(e,r,t)=>(t=e!=null?se(ue(e)):{},A(r||!e||!e.__esModule?_(t,"default",{value:e,enumerable:!0}):t,e)),de=e=>A(_({},"__esModule",{value:!0}),e);var g=(e,r,t)=>new Promise((s,n)=>{var a=o=>{try{c(t.next(o))}catch(p){n(p)}},i=o=>{try{c(t.throw(o))}catch(p){n(p)}},c=o=>o.done?s(o.value):Promise.resolve(o.value).then(a,i);c((t=t.apply(e,r)).next())});var l=pe((De,D)=>{D.exports=shelter.solidWeb});var Re={};me(Re,{onUnload:()=>Oe});var C=u(l(),1),I=u(l(),1),$=u(l(),1),ne=u(l(),1),x=u(l(),1),B=u(l(),1),m=u(l(),1);var T="._subtitle_rel3j_1{margin-top:12px;display:block}._pluginList_rel3j_1{display:grid;grid-template-columns:repeat(2, 1fr);grid-gap:16px;margin-top:16px}._repoHeader_rel3j_1{display:flex;flex-direction:row;justify-content:space-between;align-items:center}",h={subtitle:"_subtitle_rel3j_1",pluginList:"_pluginList_rel3j_1",repoHeader:"_repoHeader_rel3j_1"};var v=u(l(),1),P=u(l(),1),X=u(l(),1),b=u(l(),1),f=u(l(),1),Ve=u(l(),1);function E(){let e=document.createElement("iframe"),r=setInterval(()=>{if(!document.head)return;document.head.append(e);let t=Object.getOwnPropertyDescriptor(e.contentWindow,"localStorage");e.remove(),t&&(Object.defineProperty(window,"localStorage",t),clearInterval(r))},50)}function U(e){localStorage.setItem("plugins-browser-cache",`${Date.now()};${JSON.stringify(e)}`)}function W(){let e=localStorage.getItem("plugins-browser-cache");if(!e)return null;let[r,t]=e.split(";"),s=null;try{s=JSON.parse(t)}catch(n){return console.log("[Plugin Browser] Error parsing cache JSON: ",n),null}return fe(r),s}function fe(e){Date.now()-parseInt(e)>1e3*60*60&&localStorage.removeItem("plugins-browser-cache")}function y(){let e=localStorage.getItem("plugins-browser-plugin-json");if(!e)return{};let[r,t]=e.split(";"),s=null;try{s=JSON.parse(t)}catch(n){return console.log("[Plugin Browser] Error parsing cache JSON: ",n),{}}return _e(r),s}function q(e,r){localStorage.setItem("plugins-browser-plugin-json",`${Date.now()};${JSON.stringify(R(O({},y()),{[e]:r}))}`)}function _e(e){Date.now()-parseInt(e)>1e3*60*60&&localStorage.removeItem("plugins-browser-plugin-json")}var w=e=>g(void 0,null,function*(){return fetch(e,{headers:{"User-Agent":"Shelter Plugin Browser"}})});function he(){return g(this,null,function*(){return(yield(yield w("https://api.github.com/search/repositories?q=shelter-plugins")).json()).items.map(t=>({name:t.name,description:t.description,url:t.html_url,stars:t.stargazers_count,owner:t.owner.login,owner_url:t.owner.html_url,owner_avatar:t.owner.avatar_url,homepage:t.homepage}))})}function we(e){return g(this,null,function*(){return e.homepage?e.homepage:`https://${e.owner}.github.io/${e.name}`})}function be(e){return g(this,null,function*(){let t=yield(yield w(`https://api.github.com/repos/${e.owner}/${e.name}/contents/plugins`)).json();return Array.isArray(t)?t.map(s=>s.name):[]})}function $e(e,r){return g(this,null,function*(){let t=r==null?void 0:r[0];if(!t)return e;let s=[`${e}/shelter-plugins/`,`${e}/`],n=e;for(let a of s){let i=`${a}/${t}/plugin.json`,c=yield w(i);try{if((yield c.json()).name){n=a;break}}catch(o){}}return n})}function z(e,r){return g(this,null,function*(){let t=`${e}/${r}/plugin.json`,s=y();if(s[t])return s[t];let n=yield w(t);try{let a=yield n.json();return q(t,a),a}catch(a){return console.log("[Plugin Browser] Error parsing plugin.json: ",a.message),null}})}function F(){return g(this,null,function*(){let e=yield he();console.log(e);let r=yield Promise.all(e.map(t=>g(this,null,function*(){let s=yield we(t);if(!s)return console.log("[Plugin Browser] No site found for repo: ",t.name),null;let n=yield be(t);return!n||n.length===0?(console.log(`[Plugin Browser] No plugins found for repo: ${t.owner}/${t.name}`),null):{site:yield $e(s,n),repo:t,plugins:n}})));return r=r.filter(t=>t!==null),U(r),r})}var V="._pluginCard_9arrd_1{display:flex;flex-direction:column;justify-content:space-evenly;align-items:flex-start;text-align:left;padding:16px;color:var(--text-primary);background:var(--background-secondary);border-radius:8px}._pluginCard_9arrd_1 ._contents_9arrd_1{margin-top:8px;flex:1}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1{margin-top:8px;width:100%}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1 ._installButton_9arrd_1{flex-grow:1;width:100%}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1 ._installButton_9arrd_1 button P{width:100%}",d={pluginCard:"_pluginCard_9arrd_1",contents:"_contents_9arrd_1",buttonContainer:"_buttonContainer_9arrd_1",installButton:"_installButton_9arrd_1"};var G=(0,v.template)("<b></b>",2),xe=(0,v.template)("<div><div></div></div>",4),{ui:{injectCss:Ce,Button:ye,Text:K},solid:{createSignal:M,createEffect:je},plugins:{installedPlugins:j,addRemotePlugin:Pe}}=shelter,Q=!1;function Y(e){Q||(Ce(V),Q=!0);let[r,t]=M({}),[s,n]=M(!1);je(()=>g(this,null,function*(){t(yield z(e.site,e.plugin));let i=Object.values((j==null?void 0:j())||{}).some(c=>{var o,p;return c.manifest.name===((o=r())==null?void 0:o.name)&&c.manifest.author===((p=r())==null?void 0:p.author)});n(i)}));let a=()=>{Pe(e.plugin,e.install_url,!0),n(!0)};return(()=>{let i=xe.cloneNode(!0),c=i.firstChild;return(0,f.insert)(i,(0,b.createComponent)(K,{get class(){return d.name},get children(){return[(()=>{let o=G.cloneNode(!0);return(0,f.insert)(o,()=>{var p;return((p=r())==null?void 0:p.name)||e.plugin}),o})()," by ",(()=>{let o=G.cloneNode(!0);return(0,f.insert)(o,()=>e.author),o})()]}}),c),(0,f.insert)(i,(0,b.createComponent)(K,{get class(){return d.contents},get children(){var o;return(o=r())==null?void 0:o.description}}),c),(0,f.insert)(c,(0,b.createComponent)(ye,{get class(){return d.installButton},onClick:a,get disabled(){var o;return s()||!((o=r())!=null&&o.name)},get children(){return s()?"Installed":"Install"}})),(0,X.effect)(o=>{let p=d.pluginCard,J=d.buttonContainer;return p!==o._v$&&(0,P.className)(i,o._v$=p),J!==o._v$2&&(0,P.className)(c,o._v$2=J),o},{_v$:void 0,_v$2:void 0}),i})()}var ve=(0,C.template)('<a href="https://github.com/SpikeHD/shelter-plugins/tree/main/plugins/plugin-browser" target="_blank">Take a look</a>',2),Se=(0,C.template)('<a target="_blank">View Repository</a>',2),Z=(0,C.template)("<div></div>",2),{ui:{injectCss:Ne,Header:S,HeaderTags:N,Text:Ie,Divider:ee,TextBox:Be},solid:{createSignal:te,createEffect:Je}}=shelter,re=!1,ke=(e,r)=>{let t=null;return(...s)=>{window.clearTimeout(t),t=window.setTimeout(()=>{e(...s)},r)}};function oe(){re||(Ne(T),re=!0);let[e,r]=te([]),[t,s]=te("");return Je(()=>g(this,null,function*(){r(W()||(yield F()))})),[(0,m.createComponent)(S,{get tag(){return N.H1},children:"Plugins"}),(0,m.createComponent)(Ie,{get class(){return h.subtitle},get children(){return["Not seeing your plugin repo? ",ve.cloneNode(!0)," at how this plugin finds repos!"]}}),(0,m.createComponent)(ee,{mt:16,mb:16}),(0,m.createComponent)(Be,{get value(){return t()},get onInput(){return ke(n=>s(n),100)},placeholder:"Search..."}),(0,B.memo)(()=>e().map(n=>[(0,m.createComponent)(ee,{mt:16,mb:16}),(()=>{let a=Z.cloneNode(!0);return(0,$.insert)(a,(0,m.createComponent)(S,{get tag(){return N.H2},get children(){return n.repo.owner}}),null),(0,$.insert)(a,(0,m.createComponent)(S,{get tag(){return N.H2},get children(){return[(()=>{let i=Se.cloneNode(!0);return(0,x.effect)(()=>(0,ne.setAttribute)(i,"href",n.repo.url)),i})()," - ",(0,B.memo)(()=>n.repo.stars)," \u2B50"]}}),null),(0,x.effect)(()=>(0,I.className)(a,h.repoHeader)),a})(),(()=>{let a=Z.cloneNode(!0);return(0,$.insert)(a,()=>n.plugins.map(i=>i.toLowerCase().includes("dorion")||!i.toLowerCase().includes(t().toLowerCase())?null:(0,m.createComponent)(Y,{plugin:i,get site(){return n.site},get author(){return n.repo.owner},get install_url(){return`${n.site}/${i}`}}))),(0,x.effect)(()=>(0,I.className)(a,h.pluginList)),a})()]))]}var{settings:{registerSection:He}}=shelter,Le=He("section","plugin-browser","Plugin Browser",oe);window.localStorage||E();var Oe=()=>{Le()};return de(Re);})();
