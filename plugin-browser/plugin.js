(()=>{var ae=Object.create;var _=Object.defineProperty,ie=Object.defineProperties,le=Object.getOwnPropertyDescriptor,ce=Object.getOwnPropertyDescriptors,ue=Object.getOwnPropertyNames,k=Object.getOwnPropertySymbols,ge=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var L=(e,r,t)=>r in e?_(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,O=(e,r)=>{for(var t in r||={})H.call(r,t)&&L(e,t,r[t]);if(k)for(var t of k(r))pe.call(r,t)&&L(e,t,r[t]);return e},R=(e,r)=>ie(e,ce(r));var me=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),de=(e,r)=>{for(var t in r)_(e,t,{get:r[t],enumerable:!0})},T=(e,r,t,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of ue(r))!H.call(e,n)&&n!==t&&_(e,n,{get:()=>r[n],enumerable:!(s=le(r,n))||s.enumerable});return e};var u=(e,r,t)=>(t=e!=null?ae(ge(e)):{},T(r||!e||!e.__esModule?_(t,"default",{value:e,enumerable:!0}):t,e)),fe=e=>T(_({},"__esModule",{value:!0}),e);var g=(e,r,t)=>new Promise((s,n)=>{var l=o=>{try{a(t.next(o))}catch(p){n(p)}},i=o=>{try{a(t.throw(o))}catch(p){n(p)}},a=o=>o.done?s(o.value):Promise.resolve(o.value).then(l,i);a((t=t.apply(e,r)).next())});var c=me((Ae,D)=>{D.exports=shelter.solidWeb});var Te={};de(Te,{onUnload:()=>Re});var y=u(c(),1),B=u(c(),1),$=u(c(),1),oe=u(c(),1),x=u(c(),1),C=u(c(),1),m=u(c(),1);var A="._subtitle_rel3j_1{margin-top:12px;display:block}._pluginList_rel3j_1{display:grid;grid-template-columns:repeat(2, 1fr);grid-gap:16px;margin-top:16px}._repoHeader_rel3j_1{display:flex;flex-direction:row;justify-content:space-between;align-items:center}",h={subtitle:"_subtitle_rel3j_1",pluginList:"_pluginList_rel3j_1",repoHeader:"_repoHeader_rel3j_1"};var S=u(c(),1),v=u(c(),1),X=u(c(),1),b=u(c(),1),f=u(c(),1),Ge=u(c(),1);function E(){let e=document.createElement("iframe"),r=setInterval(()=>{if(!document.head)return;document.head.append(e);let t=Object.getOwnPropertyDescriptor(e.contentWindow,"localStorage");e.remove(),t&&(Object.defineProperty(window,"localStorage",t),clearInterval(r))},50)}function F(e){localStorage.setItem("plugins-browser-cache",`${Date.now()};${JSON.stringify(e)}`)}function U(){let e=localStorage.getItem("plugins-browser-cache");if(!e)return null;let[r,t]=e.split(";"),s=null;try{s=JSON.parse(t)}catch(n){return console.log("[Plugin Browser] Error parsing cache JSON: ",n),null}return _e(r),s}function _e(e){Date.now()-parseInt(e)>1e3*60*60&&localStorage.removeItem("plugins-browser-cache")}function j(){let e=localStorage.getItem("plugins-browser-plugin-json");if(!e)return{};let[r,t]=e.split(";"),s=null;try{s=JSON.parse(t)}catch(n){return console.log("[Plugin Browser] Error parsing cache JSON: ",n),{}}return he(r),s}function W(e,r){localStorage.setItem("plugins-browser-plugin-json",`${Date.now()};${JSON.stringify(R(O({},j()),{[e]:r}))}`)}function he(e){Date.now()-parseInt(e)>1e3*60*60&&localStorage.removeItem("plugins-browser-plugin-json")}var w=e=>g(void 0,null,function*(){return fetch(e,{headers:{"User-Agent":"Shelter Plugin Browser"}})});function we(){return g(this,null,function*(){return(yield(yield w("https://api.github.com/search/repositories?q=shelter-plugins")).json()).items.map(t=>({name:t.name,description:t.description,url:t.html_url,stars:t.stargazers_count,owner:t.owner.login,owner_url:t.owner.html_url,owner_avatar:t.owner.avatar_url,homepage:t.homepage}))})}function be(e){return g(this,null,function*(){return e.homepage?e.homepage:`https://${e.owner}.github.io/${e.name}`})}function $e(e){return g(this,null,function*(){let t=yield(yield w(`https://api.github.com/repos/${e.owner}/${e.name}/contents/plugins`)).json();return Array.isArray(t)?t.map(s=>s.name):[]})}function xe(e,r){return g(this,null,function*(){let t=r==null?void 0:r[0];if(!t)return e;let s=[`${e}/shelter-plugins/`,`${e}/`],n=e;for(let l of s){let i=`${l}/${t}/plugin.json`,a=yield w(i);try{if((yield a.json()).name){n=l;break}}catch(o){}}return n})}function q(e,r){return g(this,null,function*(){let t=`${e}/${r}/plugin.json`,s=j();if(s[t])return s[t];let n=yield w(t);try{let l=yield n.json();return W(t,l),l}catch(l){return console.log("[Plugin Browser] Error parsing plugin.json: ",l.message),null}})}function z(){return g(this,null,function*(){let e=yield we(),r=yield Promise.all(e.map(t=>g(this,null,function*(){let s=yield be(t);if(!s)return console.log("[Plugin Browser] No site found for repo: ",t.name),null;let n=yield $e(t);return!n||n.length===0?(console.log(`[Plugin Browser] No plugins found for repo: ${t.owner}/${t.name}`),null):{site:yield xe(s,n),repo:t,plugins:n}})));return r=r.filter(t=>t!==null),F(r),r})}var V="._pluginCard_9arrd_1{display:flex;flex-direction:column;justify-content:space-evenly;align-items:flex-start;text-align:left;padding:16px;color:var(--text-primary);background:var(--background-secondary);border-radius:8px}._pluginCard_9arrd_1 ._contents_9arrd_1{margin-top:8px;flex:1}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1{margin-top:8px;width:100%}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1 ._installButton_9arrd_1{flex-grow:1;width:100%}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1 ._installButton_9arrd_1 button P{width:100%}",d={pluginCard:"_pluginCard_9arrd_1",contents:"_contents_9arrd_1",buttonContainer:"_buttonContainer_9arrd_1",installButton:"_installButton_9arrd_1"};var G=(0,S.template)("<b></b>",2),Ce=(0,S.template)("<div><div></div></div>",4),{ui:{injectCss:ye,Button:je,Text:K},solid:{createSignal:M,createEffect:Pe},plugins:{installedPlugins:P,addRemotePlugin:ve}}=shelter,Q=!1;function Y(e){Q||(ye(V),Q=!0);let[r,t]=M({}),[s,n]=M(!1);Pe(()=>g(this,null,function*(){t(yield q(e.site,e.plugin));let i=Object.values((P==null?void 0:P())||{}).some(a=>{var o,p;return a.manifest.name===((o=r())==null?void 0:o.name)&&a.manifest.author===((p=r())==null?void 0:p.author)});n(i)}));let l=()=>{ve(e.plugin,e.install_url,!0),n(!0)};return(()=>{let i=Ce.cloneNode(!0),a=i.firstChild;return(0,f.insert)(i,(0,b.createComponent)(K,{get class(){return d.name},get children(){return[(()=>{let o=G.cloneNode(!0);return(0,f.insert)(o,()=>{var p;return((p=r())==null?void 0:p.name)||e.plugin}),o})()," by ",(()=>{let o=G.cloneNode(!0);return(0,f.insert)(o,()=>e.author),o})()]}}),a),(0,f.insert)(i,(0,b.createComponent)(K,{get class(){return d.contents},get children(){var o;return(o=r())==null?void 0:o.description}}),a),(0,f.insert)(a,(0,b.createComponent)(je,{get class(){return d.installButton},onClick:l,get disabled(){var o;return s()||!((o=r())!=null&&o.name)},get children(){return s()?"Installed":"Install"}})),(0,X.effect)(o=>{let p=d.pluginCard,J=d.buttonContainer;return p!==o._v$&&(0,v.className)(i,o._v$=p),J!==o._v$2&&(0,v.className)(a,o._v$2=J),o},{_v$:void 0,_v$2:void 0}),i})()}var Se=(0,y.template)('<a href="https://github.com/SpikeHD/shelter-plugins/tree/main/plugins/plugin-browser" target="_blank">Take a look</a>',2),Ne=(0,y.template)('<a target="_blank">View Repository</a>',2),Z=(0,y.template)("<div></div>",2),{ui:{injectCss:Ie,Header:N,HeaderTags:I,Text:ee,Divider:te,TextBox:Be,showToast:Je},solid:{createSignal:re,createEffect:ke}}=shelter,ne=!1,Le=(e,r)=>{let t=null;return(...s)=>{window.clearTimeout(t),t=window.setTimeout(()=>{e(...s)},r)}};function se(){ne||(Ie(A),ne=!0);let[e,r]=re([]),[t,s]=re("");return ke(()=>g(this,null,function*(){r(U()||(yield z().catch(n=>(console.error(n),Je({title:"Plugin Browser",content:"Failed to load plugins, check DevTools for error.",duration:5e3}),[]))))})),[(0,m.createComponent)(N,{get tag(){return I.H1},children:"Plugins"}),(0,m.createComponent)(ee,{get class(){return h.subtitle},get children(){return["Not seeing your plugin repo? ",Se.cloneNode(!0)," at how this plugin finds repos!"]}}),(0,m.createComponent)(te,{mt:16,mb:16}),(0,m.createComponent)(Be,{get value(){return t()},get onInput(){return Le(n=>s(n),100)},placeholder:"Search..."}),(0,C.memo)((()=>{let n=(0,C.memo)(()=>e().length>0);return()=>n()?e().map(l=>[(0,m.createComponent)(te,{mt:16,mb:16}),(()=>{let i=Z.cloneNode(!0);return(0,$.insert)(i,(0,m.createComponent)(N,{get tag(){return I.H2},get children(){return l.repo.owner}}),null),(0,$.insert)(i,(0,m.createComponent)(N,{get tag(){return I.H2},get children(){return[(()=>{let a=Ne.cloneNode(!0);return(0,x.effect)(()=>(0,oe.setAttribute)(a,"href",l.repo.url)),a})()," - ",(0,C.memo)(()=>l.repo.stars)," \u2B50"]}}),null),(0,x.effect)(()=>(0,B.className)(i,h.repoHeader)),i})(),(()=>{let i=Z.cloneNode(!0);return(0,$.insert)(i,()=>l.plugins.map(a=>a.toLowerCase().includes("dorion")||!a.toLowerCase().includes(t().toLowerCase())?null:(0,m.createComponent)(Y,{plugin:a,get site(){return l.site},get author(){return l.repo.owner},get install_url(){return`${l.site}/${a}`}}))),(0,x.effect)(()=>(0,B.className)(i,h.pluginList)),i})()]):(0,m.createComponent)(ee,{children:"Loading..."})})())]}var{settings:{registerSection:He}}=shelter,Oe=He("section","plugin-browser","Plugin Browser",se);window.localStorage||E();var Re=()=>{Oe()};return fe(Te);})();
