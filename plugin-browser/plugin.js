(()=>{var M=Object.create;var d=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var ee=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),te=(e,n)=>{for(var t in n)d(e,t,{get:n[t],enumerable:!0})},H=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of X(n))!Z.call(e,o)&&o!==t&&d(e,o,{get:()=>n[o],enumerable:!(s=Q(n,o))||s.enumerable});return e};var i=(e,n,t)=>(t=e!=null?M(Y(e)):{},H(n||!e||!e.__esModule?d(t,"default",{value:e,enumerable:!0}):t,e)),ne=e=>H(d({},"__esModule",{value:!0}),e);var u=(e,n,t)=>new Promise((s,o)=>{var x=r=>{try{c(t.next(r))}catch(l){o(l)}},g=r=>{try{c(t.throw(r))}catch(l){o(l)}},c=r=>r.done?s(r.value):Promise.resolve(r.value).then(x,g);c((t=t.apply(e,n)).next())});var a=ee((je,I)=>{I.exports=shelter.solidWeb});var be={};te(be,{onUnload:()=>xe});var $=i(a(),1),B=i(a(),1),h=i(a(),1),G=i(a(),1),w=i(a(),1),k=i(a(),1),m=i(a(),1);var R="._pluginList_bgpat_1{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:space-evenly;align-items:flex-start}._repoHeader_bgpat_1{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-top:20px}",b={pluginList:"_pluginList_bgpat_1",repoHeader:"_repoHeader_bgpat_1"};var C=i(a(),1),P=i(a(),1),z=i(a(),1),_=i(a(),1),p=i(a(),1),Se=i(a(),1);function J(e){localStorage.setItem("plugins-browser-cache",`${Date.now()};${JSON.stringify(e)}`)}function L(){let e=localStorage.getItem("plugins-browser-cache");if(!e)return null;let[n,t]=e.split(";"),s=null;try{s=JSON.parse(t)}catch(o){return console.log("[Plugin Browser] Error parsing cache JSON: ",o),null}return re(n),s}function re(e){Date.now()-parseInt(e)>1e3*60*60&&localStorage.removeItem("plugins-browser-cache")}var y=e=>u(void 0,null,function*(){return fetch(e,{headers:{"User-Agent":"Shelter Plugin Browser"}})});function se(){return u(this,null,function*(){return(yield(yield y("https://api.github.com/search/repositories?q=topic:shelter-plugins")).json()).items.map(t=>({name:t.name,description:t.description,url:t.html_url,stars:t.stargazers_count,owner:t.owner.login,owner_url:t.owner.html_url,owner_avatar:t.owner.avatar_url,homepage:t.homepage}))})}function oe(e){return u(this,null,function*(){return e.homepage?e.homepage:`https://${e.owner}.github.io/${e.name}`})}function ae(e){return u(this,null,function*(){return(yield(yield y(`https://api.github.com/repos/${e.owner}/${e.name}/contents/plugins`)).json()).map(s=>s.name)})}function A(e,n){return u(this,null,function*(){let t=yield y(`${e}/${n}/plugin.json`);try{return yield t.json()}catch(s){return console.log("[Plugin Browser] Error parsing plugin.json: ",s.message),null}})}function E(){return u(this,null,function*(){let e=yield se(),n=yield Promise.all(e.map(t=>u(this,null,function*(){let s=yield oe(t);if(!s)return console.log("[Plugin Browser] No site found for repo: ",t.name),null;let o=yield ae(t);return o?{repo:t,site:s,plugins:o}:(console.log("[Plugin Browser] No plugins found for repo: ",t.name),null)})));return n=n.filter(t=>t!==null),J(n),n})}var O="._pluginCard_124w5_1{display:flex;flex-direction:column;justify-content:space-evenly;align-items:flex-start;text-align:left;flex-grow:1;flex-shrink:1;width:40%;margin:10px;padding:8px;background:var(--input-background);border-radius:5px}._pluginCard_124w5_1>span{padding:4px 0}._installButton_124w5_1{flex-grow:1;width:100%}._installButton_124w5_1 button P{width:100%}",f={pluginCard:"_pluginCard_124w5_1",installButton:"_installButton_124w5_1"};var T=(0,C.template)("<b></b>",2),ie=(0,C.template)("<div><div></div></div>",4),{ui:{injectCss:le,Button:ue,Text:D},solid:{createSignal:U,createEffect:ce},plugins:{installedPlugins:j,addRemotePlugin:ge}}=shelter,q=!1;function F(e){q||(le(O),q=!0);let[n,t]=U({}),[s,o]=U(!1);ce(()=>u(this,null,function*(){t(yield A(e.site,e.plugin));let g=Object.values((j==null?void 0:j())||{}).some(c=>{var r,l;return c.manifest.name===((r=n())==null?void 0:r.name)&&c.manifest.author===((l=n())==null?void 0:l.author)});o(g)}));let x=()=>{ge(e.plugin,e.install_url,!0),o(!0)};return(()=>{let g=ie.cloneNode(!0),c=g.firstChild;return(0,p.insert)(g,(0,_.createComponent)(D,{get class(){return f.name},get children(){return[(()=>{let r=T.cloneNode(!0);return(0,p.insert)(r,()=>{var l;return((l=n())==null?void 0:l.name)||"Unknown"}),r})()," by ",(()=>{let r=T.cloneNode(!0);return(0,p.insert)(r,()=>e.author),r})()]}}),c),(0,p.insert)(g,(0,_.createComponent)(D,{get children(){var r;return(r=n())==null?void 0:r.description}}),c),(0,p.insert)(c,(0,_.createComponent)(ue,{get class(){return f.installButton},onClick:x,get disabled(){var r;return s()||!((r=n())!=null&&r.name)},get children(){return s()?"Installed":"Install"}})),(0,z.effect)(r=>{let l=f.pluginCard,S=f.installButton;return l!==r._v$&&(0,P.className)(g,r._v$=l),S!==r._v$2&&(0,P.className)(c,r._v$2=S),r},{_v$:void 0,_v$2:void 0}),g})()}var pe=(0,$.template)('<a href="https://github.com/SpikeHD/shelter-plugins/tree/main/plugins/plugin-browser" target="_blank">Take a look</a>',2),me=(0,$.template)('<a target="_blank">View Repository</a>',2),V=(0,$.template)("<div></div>",2),{ui:{injectCss:fe,Header:v,HeaderTags:N,Text:de},solid:{createSignal:_e,createEffect:he}}=shelter,W=!1;function K(){W||(fe(R),W=!0);let[e,n]=_e([]);return he(()=>u(this,null,function*(){n(L()||(yield E()))})),[(0,m.createComponent)(v,{get tag(){return N.H1},children:"Plugins"}),(0,m.createComponent)(de,{get children(){return["Not seeing your plugin repo? ",pe.cloneNode(!0)," at how this plugin finds repos!"]}}),(0,k.memo)(()=>e().map(t=>[(()=>{let s=V.cloneNode(!0);return(0,h.insert)(s,(0,m.createComponent)(v,{get tag(){return N.H2},get children(){return t.repo.owner}}),null),(0,h.insert)(s,(0,m.createComponent)(v,{get tag(){return N.H2},get children(){return[(()=>{let o=me.cloneNode(!0);return(0,w.effect)(()=>(0,G.setAttribute)(o,"href",t.repo.url)),o})()," - ",(0,k.memo)(()=>t.repo.stars)," \u2B50"]}}),null),(0,w.effect)(()=>(0,B.className)(s,b.repoHeader)),s})(),(()=>{let s=V.cloneNode(!0);return(0,h.insert)(s,()=>t.plugins.map(o=>o.toLowerCase().includes("dorion")?null:(0,m.createComponent)(F,{plugin:o,get site(){return t.site},get author(){return t.repo.owner},get install_url(){return`${t.site}/${o}`}}))),(0,w.effect)(()=>(0,B.className)(s,b.pluginList)),s})()]))]}var{settings:{registerSection:we}}=shelter,$e=we("section","plugin-browser","Plugin Browser",K),xe=()=>{$e()};return ne(be);})();
