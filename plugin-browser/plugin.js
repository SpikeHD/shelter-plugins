(()=>{var M=Object.create;var f=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var ee=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),te=(e,n)=>{for(var t in n)f(e,t,{get:n[t],enumerable:!0})},H=(e,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of X(n))!Z.call(e,s)&&s!==t&&f(e,s,{get:()=>n[s],enumerable:!(o=Q(n,s))||o.enumerable});return e};var l=(e,n,t)=>(t=e!=null?M(Y(e)):{},H(n||!e||!e.__esModule?f(t,"default",{value:e,enumerable:!0}):t,e)),ne=e=>H(f({},"__esModule",{value:!0}),e);var u=(e,n,t)=>new Promise((o,s)=>{var m=r=>{try{i(t.next(r))}catch(c){s(c)}},g=r=>{try{i(t.throw(r))}catch(c){s(c)}},i=r=>r.done?o(r.value):Promise.resolve(r.value).then(m,g);i((t=t.apply(e,n)).next())});var a=ee((Pe,I)=>{I.exports=shelter.solidWeb});var je={};te(je,{onUnload:()=>Ce});var C=l(a(),1),B=l(a(),1),b=l(a(),1),G=l(a(),1),x=l(a(),1),k=l(a(),1),p=l(a(),1);var R="._subtitle_rel3j_1{margin-top:12px;display:block}._pluginList_rel3j_1{display:grid;grid-template-columns:repeat(2, 1fr);grid-gap:16px;margin-top:16px}._repoHeader_rel3j_1{display:flex;flex-direction:row;justify-content:space-between;align-items:center}",h={subtitle:"_subtitle_rel3j_1",pluginList:"_pluginList_rel3j_1",repoHeader:"_repoHeader_rel3j_1"};var P=l(a(),1),y=l(a(),1),z=l(a(),1),$=l(a(),1),d=l(a(),1),Ie=l(a(),1);function J(e){localStorage.setItem("plugins-browser-cache",`${Date.now()};${JSON.stringify(e)}`)}function L(){let e=localStorage.getItem("plugins-browser-cache");if(!e)return null;let[n,t]=e.split(";"),o=null;try{o=JSON.parse(t)}catch(s){return console.log("[Plugin Browser] Error parsing cache JSON: ",s),null}return re(n),o}function re(e){Date.now()-parseInt(e)>1e3*60*60&&localStorage.removeItem("plugins-browser-cache")}var w=e=>u(void 0,null,function*(){return fetch(e,{headers:{"User-Agent":"Shelter Plugin Browser"}})});function oe(){return u(this,null,function*(){return(yield(yield w("https://api.github.com/search/repositories?q=topic:shelter-plugins")).json()).items.map(t=>({name:t.name,description:t.description,url:t.html_url,stars:t.stargazers_count,owner:t.owner.login,owner_url:t.owner.html_url,owner_avatar:t.owner.avatar_url,homepage:t.homepage}))})}function se(e){return u(this,null,function*(){return e.homepage?e.homepage:`https://${e.owner}.github.io/${e.name}`})}function ae(e){return u(this,null,function*(){return(yield(yield w(`https://api.github.com/repos/${e.owner}/${e.name}/contents/plugins`)).json()).map(o=>o.name)})}function ie(e,n){return u(this,null,function*(){let t=n==null?void 0:n[0];if(!t)return e;let o=[`${e}/shelter-plugins/`,`${e}/`],s=e;for(let m of o){let g=`${m}/${t}/plugin.json`,i=yield w(g);try{if((yield i.json()).name){s=m;break}}catch(r){}}return s})}function A(e,n){return u(this,null,function*(){let t=yield w(`${e}/${n}/plugin.json`);try{return yield t.json()}catch(o){return console.log("[Plugin Browser] Error parsing plugin.json: ",o.message),null}})}function D(){return u(this,null,function*(){let e=yield oe(),n=yield Promise.all(e.map(t=>u(this,null,function*(){let o=yield se(t);if(!o)return console.log("[Plugin Browser] No site found for repo: ",t.name),null;let s=yield ae(t);return s?{site:yield ie(o,s),repo:t,plugins:s}:(console.log("[Plugin Browser] No plugins found for repo: ",t.name),null)})));return n=n.filter(t=>t!==null),J(n),n})}var E="._pluginCard_9arrd_1{display:flex;flex-direction:column;justify-content:space-evenly;align-items:flex-start;text-align:left;padding:16px;color:var(--text-primary);background:var(--background-secondary);border-radius:8px}._pluginCard_9arrd_1 ._contents_9arrd_1{margin-top:8px;flex:1}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1{margin-top:8px;width:100%}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1 ._installButton_9arrd_1{flex-grow:1;width:100%}._pluginCard_9arrd_1 ._buttonContainer_9arrd_1 ._installButton_9arrd_1 button P{width:100%}",_={pluginCard:"_pluginCard_9arrd_1",contents:"_contents_9arrd_1",buttonContainer:"_buttonContainer_9arrd_1",installButton:"_installButton_9arrd_1"};var O=(0,P.template)("<b></b>",2),le=(0,P.template)("<div><div></div></div>",4),{ui:{injectCss:ue,Button:ce,Text:T},solid:{createSignal:U,createEffect:ge},plugins:{installedPlugins:j,addRemotePlugin:pe}}=shelter,q=!1;function F(e){q||(ue(E),q=!0);let[n,t]=U({}),[o,s]=U(!1);ge(()=>u(this,null,function*(){t(yield A(e.site,e.plugin));let g=Object.values((j==null?void 0:j())||{}).some(i=>{var r,c;return i.manifest.name===((r=n())==null?void 0:r.name)&&i.manifest.author===((c=n())==null?void 0:c.author)});s(g)}));let m=()=>{pe(e.plugin,e.install_url,!0),s(!0)};return(()=>{let g=le.cloneNode(!0),i=g.firstChild;return(0,d.insert)(g,(0,$.createComponent)(T,{get class(){return _.name},get children(){return[(()=>{let r=O.cloneNode(!0);return(0,d.insert)(r,()=>{var c;return((c=n())==null?void 0:c.name)||"Unknown"}),r})()," by ",(()=>{let r=O.cloneNode(!0);return(0,d.insert)(r,()=>e.author),r})()]}}),i),(0,d.insert)(g,(0,$.createComponent)(T,{get class(){return _.contents},get children(){var r;return(r=n())==null?void 0:r.description}}),i),(0,d.insert)(i,(0,$.createComponent)(ce,{get class(){return _.installButton},onClick:m,get disabled(){var r;return o()||!((r=n())!=null&&r.name)},get children(){return o()?"Installed":"Install"}})),(0,z.effect)(r=>{let c=_.pluginCard,S=_.buttonContainer;return c!==r._v$&&(0,y.className)(g,r._v$=c),S!==r._v$2&&(0,y.className)(i,r._v$2=S),r},{_v$:void 0,_v$2:void 0}),g})()}var me=(0,C.template)('<a href="https://github.com/SpikeHD/shelter-plugins/tree/main/plugins/plugin-browser" target="_blank">Take a look</a>',2),_e=(0,C.template)('<a target="_blank">View Repository</a>',2),V=(0,C.template)("<div></div>",2),{ui:{injectCss:de,Header:v,HeaderTags:N,Text:fe,Divider:he},solid:{createSignal:we,createEffect:$e}}=shelter,W=!1;function K(){W||(de(R),W=!0);let[e,n]=we([]);return $e(()=>u(this,null,function*(){n(L()||(yield D()))})),[(0,p.createComponent)(v,{get tag(){return N.H1},children:"Plugins"}),(0,p.createComponent)(fe,{get class(){return h.subtitle},get children(){return["Not seeing your plugin repo? ",me.cloneNode(!0)," at how this plugin finds repos!"]}}),(0,k.memo)(()=>e().map(t=>[(0,p.createComponent)(he,{mt:16,mb:16}),(()=>{let o=V.cloneNode(!0);return(0,b.insert)(o,(0,p.createComponent)(v,{get tag(){return N.H2},get children(){return t.repo.owner}}),null),(0,b.insert)(o,(0,p.createComponent)(v,{get tag(){return N.H2},get children(){return[(()=>{let s=_e.cloneNode(!0);return(0,x.effect)(()=>(0,G.setAttribute)(s,"href",t.repo.url)),s})()," - ",(0,k.memo)(()=>t.repo.stars)," \u2B50"]}}),null),(0,x.effect)(()=>(0,B.className)(o,h.repoHeader)),o})(),(()=>{let o=V.cloneNode(!0);return(0,b.insert)(o,()=>t.plugins.map(s=>s.toLowerCase().includes("dorion")?null:(0,p.createComponent)(F,{plugin:s,get site(){return t.site},get author(){return t.repo.owner},get install_url(){return`${t.site}/${s}`}}))),(0,x.effect)(()=>(0,B.className)(o,h.pluginList)),o})()]))]}var{settings:{registerSection:be}}=shelter,xe=be("section","plugin-browser","Plugin Browser",K),Ce=()=>{xe()};return ne(je);})();
