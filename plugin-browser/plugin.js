(()=>{var M=Object.create;var d=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var Z=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),ee=(e,n)=>{for(var t in n)d(e,t,{get:n[t],enumerable:!0})},H=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of V(n))!Y.call(e,o)&&o!==t&&d(e,o,{get:()=>n[o],enumerable:!(s=Q(n,o))||s.enumerable});return e};var l=(e,n,t)=>(t=e!=null?M(X(e)):{},H(n||!e||!e.__esModule?d(t,"default",{value:e,enumerable:!0}):t,e)),te=e=>H(d({},"__esModule",{value:!0}),e);var u=(e,n,t)=>new Promise((s,o)=>{var w=r=>{try{c(t.next(r))}catch(a){o(a)}},g=r=>{try{c(t.throw(r))}catch(a){o(a)}},c=r=>r.done?s(r.value):Promise.resolve(r.value).then(w,g);c((t=t.apply(e,n)).next())});var i=Z((be,I)=>{I.exports=shelter.solidWeb});var $e={};ee($e,{onUnload:()=>we});var S=l(i(),1),v=l(i(),1),N=l(i(),1),h=l(i(),1),B=l(i(),1),m=l(i(),1);var R="._pluginList_bgpat_1{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:space-evenly;align-items:flex-start}._repoHeader_bgpat_1{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-top:20px}",$={pluginList:"_pluginList_bgpat_1",repoHeader:"_repoHeader_bgpat_1"};var j=l(i(),1),y=l(i(),1),z=l(i(),1),_=l(i(),1),p=l(i(),1),Be=l(i(),1);function J(e){localStorage.setItem("plugins-browser-cache",`${Date.now()};${JSON.stringify(e)}`)}function L(){let e=localStorage.getItem("plugins-browser-cache");if(!e)return null;let[n,t]=e.split(";"),s=null;try{s=JSON.parse(t)}catch(o){return console.log("[Plugin Browser] Error parsing cache JSON: ",o),null}return ne(n),s}function ne(e){Date.now()-parseInt(e)>1e3*60*60&&localStorage.removeItem("plugins-browser-cache")}var x=e=>u(void 0,null,function*(){return fetch(e,{headers:{"User-Agent":"Shelter Plugin Browser"}})});function re(){return u(this,null,function*(){return(yield(yield x("https://api.github.com/search/repositories?q=topic:shelter-plugins")).json()).items.map(t=>({name:t.name,description:t.description,url:t.html_url,stars:t.stargazers_count,owner:t.owner.login,owner_url:t.owner.html_url,owner_avatar:t.owner.avatar_url,homepage:t.homepage}))})}function se(e){return u(this,null,function*(){return e.homepage?e.homepage:`https://${e.owner}.github.io/${e.name}`})}function oe(e){return u(this,null,function*(){return(yield(yield x(`https://api.github.com/repos/${e.owner}/${e.name}/contents/plugins`)).json()).map(s=>s.name)})}function E(e,n){return u(this,null,function*(){let t=yield x(`${e}/${n}/plugin.json`);try{return yield t.json()}catch(s){return console.log("[Plugin Browser] Error parsing plugin.json: ",s.message),null}})}function O(){return u(this,null,function*(){let e=yield re(),n=yield Promise.all(e.map(t=>u(this,null,function*(){let s=yield se(t);if(!s)return console.log("[Plugin Browser] No site found for repo: ",t.name),null;let o=yield oe(t);return o?{repo:t,site:s,plugins:o}:(console.log("[Plugin Browser] No plugins found for repo: ",t.name),null)})));return n=n.filter(t=>t!==null),J(n),n})}var T="._pluginCard_124w5_1{display:flex;flex-direction:column;justify-content:space-evenly;align-items:flex-start;text-align:left;flex-grow:1;flex-shrink:1;width:40%;margin:10px;padding:8px;background:var(--input-background);border-radius:5px}._pluginCard_124w5_1>span{padding:4px 0}._installButton_124w5_1{flex-grow:1;width:100%}._installButton_124w5_1 button P{width:100%}",f={pluginCard:"_pluginCard_124w5_1",installButton:"_installButton_124w5_1"};var A=(0,j.template)("<b></b>",2),ie=(0,j.template)("<div><div></div></div>",4),{ui:{injectCss:ae,Button:le,Text:D},solid:{createSignal:U,createEffect:ue},plugins:{installedPlugins:b,addRemotePlugin:ce}}=shelter,q=!1;function F(e){q||(ae(T),q=!0);let[n,t]=U({}),[s,o]=U(!1);ue(()=>u(this,null,function*(){t(yield E(e.site,e.plugin));let g=Object.values((b==null?void 0:b())||{}).some(c=>{var r,a;return c.manifest.name===((r=n())==null?void 0:r.name)&&c.manifest.author===((a=n())==null?void 0:a.author)});o(g)}));let w=()=>{ce(e.plugin,e.install_url,!0),o(!0)};return(()=>{let g=ie.cloneNode(!0),c=g.firstChild;return(0,p.insert)(g,(0,_.createComponent)(D,{get class(){return f.name},get children(){return[(()=>{let r=A.cloneNode(!0);return(0,p.insert)(r,()=>{var a;return((a=n())==null?void 0:a.name)||"Unknown"}),r})()," by ",(()=>{let r=A.cloneNode(!0);return(0,p.insert)(r,()=>e.author),r})()]}}),c),(0,p.insert)(g,(0,_.createComponent)(D,{get children(){var r;return(r=n())==null?void 0:r.description}}),c),(0,p.insert)(c,(0,_.createComponent)(le,{get class(){return f.installButton},onClick:w,get disabled(){var r;return s()||!((r=n())!=null&&r.name)},get children(){return s()?"Installed":"Install"}})),(0,z.effect)(r=>{let a=f.pluginCard,k=f.installButton;return a!==r._v$&&(0,y.className)(g,r._v$=a),k!==r._v$2&&(0,y.className)(c,r._v$2=k),r},{_v$:void 0,_v$2:void 0}),g})()}var ge=(0,S.template)('<a href="https://github.com/SpikeHD/shelter-plugins/tree/main/plugins/plugin-browser">Take a look</a>',2),W=(0,S.template)("<div></div>",2),{ui:{injectCss:pe,Header:P,HeaderTags:C,Text:me},solid:{createSignal:fe,createEffect:de}}=shelter,G=!1;function K(){G||(pe(R),G=!0);let[e,n]=fe([]);return de(()=>u(this,null,function*(){n(L()||(yield O()))})),[(0,m.createComponent)(P,{get tag(){return C.H1},children:"Plugins"}),(0,m.createComponent)(me,{get children(){return["Not seeing your plugin repo? ",ge.cloneNode(!0)," at how this plugin finds repos!"]}}),(0,B.memo)(()=>e().map(t=>[(()=>{let s=W.cloneNode(!0);return(0,h.insert)(s,(0,m.createComponent)(P,{get tag(){return C.H2},get children(){return t.repo.owner}}),null),(0,h.insert)(s,(0,m.createComponent)(P,{get tag(){return C.H2},get children(){return[(0,B.memo)(()=>t.repo.stars)," \u2B50"]}}),null),(0,N.effect)(()=>(0,v.className)(s,$.repoHeader)),s})(),(()=>{let s=W.cloneNode(!0);return(0,h.insert)(s,()=>t.plugins.map(o=>o.toLowerCase().includes("dorion")?null:(0,m.createComponent)(F,{plugin:o,get site(){return t.site},get author(){return t.repo.owner},get install_url(){return`${t.site}/${o}`}}))),(0,N.effect)(()=>(0,v.className)(s,$.pluginList)),s})()]))]}var{settings:{registerSection:_e}}=shelter,he=_e("section","plugin-browser","Plugin Browser",K),we=()=>{he()};return te($e);})();
